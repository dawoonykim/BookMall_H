<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.admin.goods">

    <resultMap id="goodsResult" type="GoodsVO">
        <result property="goodsId" column="goods_id"/>
        <result property="goodsSort" column="goods_sort"/>
        <result property="goodsTitle" column="goods_title"/>
        <result property="goodsWriter" column="goods_writer"/>
        <result property="goodsPublisher" column="goods_publisher"/>
        <result property="goodsPrice" column="goods_price"/>
        <result property="goodsSalesPrice" column="goods_sales_price"/>
        <result property="goodsPublishedDate" column="goods_published_date"/>
        <result property="goodsTotalPage" column="goods_total_page"/>
        <result property="goodsIsbn" column="goods_isbn"/>
        <result property="goodsDeliveryPrice" column="goods_delivery_price"/>
        <result property="goodsDeliveryDate" column="goods_delivery_date"/>
        <result property="goodsStatus" column="goods_status"/>
        <result property="goodsIntro" column="goods_intro"/>
        <result property="goodsWriterIntro" column="goods_writer_intro"/>
        <result property="goodsContentsOrder" column="goods_contents_order" javaType="java.lang.String"
                jdbcType="CLOB"/>
        <result property="goodsFileName" column="fileName"/>
    </resultMap>

    <resultMap id="imageResult" type="imageFileVO">
        <result property="imageId" column="image_id"/>
        <result property="goodsId" column="goods_id"/>
        <result property="fileName" column="fileName"/>
        <result property="fileType" column="fileType"/>
        <result property="regId" column="reg_id"/>
    </resultMap>

    <resultMap id="orderGoodsResult" type="OrderVO">
        <result property="orderId" column="order_id"/>
        <result property="memberId" column="member_id"/>
        <result property="goodsId" column="goods_id"/>
        <result property="ordererName" column="orderer_name"/>
        <result property="goodsTitle" column="goods_title"/>
        <result property="orderGoodsQty" column="order_goods_qty"/>
        <result property="goodsSalesPrice" column="goods_sales_price"/>
        <result property="goodsFileName" column="goods_fileName"/>
        <result property="receiverName" column="receiver_name"/>
        <result property="receiverHp1" column="receiver_hp1"/>
        <result property="receiverHp2" column="receiver_hp2"/>
        <result property="receiverHp3" column="receiver_hp3"/>
        <result property="receiverTel1" column="receiver_tel1"/>
        <result property="receiverTel2" column="receiver_tel2"/>
        <result property="receiverTel3" column="receiver_tel3"/>
        <result property="deliveryAddress" column="delivery_address"/>
        <result property="deliveryMethod" column="delivery_method"/>
        <result property="deliveryMessage" column="delivery_message"/>
        <result property="giftWrapping" column="gift_wrapping"/>
        <result property="payMethod" column="pay_method"/>
        <result property="cardComName" column="card_com_name"/>
        <result property="cardPayMonth" column="card_pay_month"/>
        <result property="payOrdererHpNum" column="pay_orderer_hp_num"/>
        <result property="deliveryState" column="delivery_state"/>
        <result property="payOrderTime" column="pay_order_time"/>
        <result property="ordererHp" column="orderer_hp"/>

        <result property="orderTotalPrice" column="order_total_price"/>
        <result property="finalTotalPrice" column="final_total_price"/>
        <result property="goodsQty" column="goods_qty"/>
    </resultMap>

    <insert id="insertNewGoods" parameterType="java.util.Map">
        <selectKey keyProperty="goodsId" resultType="String" order="BEFORE">
            select SEQ_GOODS_ID.nextval from dual
        </selectKey>
        <![CDATA[
                insert into T_SHOPPING_GOODS(
                                GOODS_ID,
                                GOODS_SORT,
                                GOODS_TITLE,
                                GOODS_WRITER,
                                GOODS_PUBLISHER,
                                GOODS_PRICE,
                                GOODS_POINT,
                                GOODS_PUBLISHED_DATE,
                                GOODS_TOTAL_PAGE,
                                GOODS_ISBN,
                                GOODS_ISBN,
                                GOODS_DELIVERY_PRICE,
                                GOODS_DELIVERY_DATE,
                                GOODS_STATUS,
                                GOODS_WRITER_INTRO,
                                GOODS_INTRO,
                                GOODS_PUBLISHER_COMMENT,
                                GOODS_RECOMMENDATION,
                                GOODS_CONTENTS_ORDER)
                values(
                                #{goodsId},
					  		    #{goodsSort},
					  			#{goodsTitle},
					  			#{goodsWriter},
					  			#{goodsPublisher},
					  			#{goodsPrice},
					  			#{goodsSalesPrice},
					  			#{goodsPoint},
					  			#{goodsPublishedDate},
					  			#{goodsTotalPage},
					  			#{goodsIsbn},
					  			#{goodsDeliveryPrice},
					  			#{goodsDeliveryDate},
					  			#{goodsStatus},
					  			#{goodsWriterIntro},
								#{goodsIntro},
					  			#{goodsPublisherComment},
					  			#{goodsRecommendation },
					  			#{goodsContentsOrder:VARCHAR}
                )
            ]]>
    </insert>

    <insert id="insertGoodsImageFile" parameterType="imageFileVO">
        <selectKey keyProperty="imageId" resultType="int" order="BEFORE">
            select SEQ_IMAGE_ID.nextval from dual
        </selectKey>
        <![CDATA[
            insert into T_GOODS_DETAIL_IMAGE(
                                             image_id,
                                             goods_id,
                                             filename,
                                             reg_id,
                                             filetype)
                                      values(
                                            #{imageId},
                                            #{goodsId},
                                            #{fileName},
                                            #{regId},
                                            #{fileType})
        ]]>
    </insert>

    <select id="selectNewGoodsList" parameterType="java.util.Map" resultType="goodsVO">
        <![CDATA[
        select *
        from (select ROWNUM                                      as recNum,
                     GOODS_ID,
                     GOODS_TITLE,
                     GOODS_WRITER,
                     GOODS_PUBLISHER,
                     GOODS_SALES_PRICE,
                     to_char(GOODS_CREDATE, 'YYYY-MM-DD')        as goods_creDate,
                     to_char(GOODS_PUBLISHED_DATE, 'YYYY-MM-DD') as goods_published_data
              from (select GOODS_ID,
                           GOODS_TITLE,
                           GOODS_WRITER,
                           GOODS_PUBLISHER,
                           GOODS_SALES_PRICE,
                           GOODS_CREDATE,
                           GOODS_PUBLISHED_DATE
                    from T_SHOPPING_GOODS
                    where to_char(GOODS_CREDATE, 'YYYY-MM-DD') between #{beginDate} and #{endDate}
                    order by GOODS_CREDATE desc))
        where recNum between (#{section} - 1) * 100 + (#{pageNum} - 1) * 10 + 1 and (#{section} - 1) * 100 + (#{pageNum}) * 10
        ]]>
    </select>
</mapper>